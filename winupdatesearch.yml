---
  - name: Search for  Windows Updates on Servers
    hosts: windows
    connection: winrm
   
    
    tasks:
        - name: Search Updates 
          win_updates:
            category_names:
              - CriticalUpdates
              - DefinitionUpdates
              - SecurityUpdates
            state: searched
            log_path: c:\{{ ansible_hostname }}_{{ ansible_date_time.date }}.log
            reboot: no

        - name: Collect the logs
          fetch:
            src: c:\{{ ansible_hostname }}_{{ ansible_date_time.date }}.log
            dest: /srv/ansible/logs/
            flat: yes
